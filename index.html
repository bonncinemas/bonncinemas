<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Bonn Cinemas</title>

    <!-- PWA Settings cho iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BonnCinemas">
    <meta name="theme-color" content="#000000">
    
    <!-- Icon cho m√†n h√¨nh ch√≠nh -->
    <link rel="apple-touch-icon" href="https://images.unsplash.com/photo-1536440136628-849c177e76a1?auto=format&fit=crop&w=192&h=192">
    <link rel="icon" type="image/jpeg" href="https://images.unsplash.com/photo-1536440136628-849c177e76a1?auto=format&fit=crop&w=192&h=192">

    <!-- Embedded Manifest -->
    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiQm9ubkNpbmVtYXMiLCJzaG9ydF9uYW1lIjoiQm9ubkNpbmVtYXMiLCJzdGFydF91cmwiOiIuIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzAwMDAwMCIsInRoZW1lX2NvbG9yIjoiIzAwMDAwMCIsImljb25zIjpbeyJzcmMiOiJodHRwczovL2ltYWdlcy51bnNwbGFzaC5jb20vcGhvdG8tMTUzNjQ0MDEzNjYyOC04NDljMTc3ZTc2YTE/YXV0bz1mb3JtYXQmZml0PWNyb3Amdz0xOTImaD0xOTIiLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2UvanBlZyJdfQ==">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Import Map -->
    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "lucide-react": "https://esm.sh/lucide-react@0.292.0"
            }
        }
    </script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { 
            background-color: #000; 
            color: white; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .screen-arc {
            width: 100%;
            height: 30px;
            border-top: 4px solid rgba(255, 255, 255, 0.6);
            border-radius: 50% 50% 0 0 / 100% 100% 0 0;
            box-shadow: 0 -5px 15px rgba(255, 255, 255, 0.3);
            background: linear-gradient(to bottom, rgba(255,255,255,0.05) 0%, transparent 100%);
        }
        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.5); }
            50% { box-shadow: 0 0 40px rgba(239, 68, 68, 0.8); }
        }
        .pt-safe-top { padding-top: env(safe-area-inset-top); }
        .pb-safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        
        /* Custom Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useMemo, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Play, Clock, Star, Ticket, Search, User, Menu, X, Info, 
            Clapperboard, Plus, Minus, CreditCard, Banknote, QrCode, 
            CheckCircle, ArrowRight, Home, Calendar, Gift, Newspaper, 
            ChevronLeft, ShoppingBag, MapPin, AlertTriangle, Smartphone, Filter
        } from 'lucide-react';

        // --- iOS Check Component ---
        const IOSGatekeeper = ({ children }) => {
            const [isCompatible, setIsCompatible] = useState(true);
            const [osVersion, setOsVersion] = useState(null);

            useEffect(() => {
                const ua = navigator.userAgent;
                const isIOS = /iPad|iPhone|iPod/.test(ua) && !window.MSStream;

                if (isIOS) {
                    const match = ua.match(/OS (\d+)_/);
                    if (match && match[1]) {
                        const version = parseInt(match[1], 10);
                        setOsVersion(version);
                        if (version < 16) {
                            setIsCompatible(false);
                        }
                    }
                }
            }, []);

            if (!isCompatible) {
                return (
                    <div className="fixed inset-0 bg-black flex flex-col items-center justify-center p-8 text-center z-[9999]">
                        <div className="w-24 h-24 bg-red-900/30 rounded-full flex items-center justify-center mb-6 animate-[pulse-red_2s_infinite]">
                            <Smartphone size={48} className="text-red-500" />
                        </div>
                        <h1 className="text-3xl font-bold text-white mb-4">Kh√¥ng h·ªó tr·ª£</h1>
                        <p className="text-slate-400 text-lg mb-8">
                            ·ª®ng d·ª•ng n√†y y√™u c·∫ßu c√°c t√≠nh nƒÉng b·∫£o m·∫≠t v√† hi·ªáu nƒÉng cao ch·ªâ c√≥ tr√™n iOS 16+.
                        </p>
                        <div className="bg-slate-900 p-4 rounded-xl border border-slate-800 w-full max-w-xs">
                            <p className="text-sm text-slate-500 uppercase font-bold mb-1">Thi·∫øt b·ªã c·ªßa b·∫°n</p>
                            <p className="text-xl text-white font-bold">iOS {osVersion}</p>
                        </div>
                        <div className="mt-8 text-red-400 text-sm font-medium flex items-center gap-2">
                            <AlertTriangle size={16} />
                            <span>Vui l√≤ng c·∫≠p nh·∫≠t iOS 16 ho·∫∑c m·ªõi h∆°n</span>
                        </div>
                    </div>
                );
            }

            return children;
        };

        // --- Mock Data ---
        const MOVIES = [
            {
                id: 1,
                title: "Avatar: D√≤ng Ch·∫£y C·ªßa N∆∞·ªõc",
                genre: "Vi·ªÖn T∆∞·ªüng",
                duration: "3h 12m",
                rating: 4.8,
                price: 120000,
                image: "https://image.tmdb.org/t/p/w500/t6HIqrRAclMCA60NsSmeqe9RmNV.jpg",
                backdrop: "https://image.tmdb.org/t/p/original/s16H6tpK2utvwDtzZ8Qy4qm5Emw.jpg",
                description: "Jake Sully s·ªëng v·ªõi gia ƒë√¨nh m·ªõi h√¨nh th√†nh c·ªßa m√¨nh tr√™n h√†nh tinh Pandora.",
                director: "James Cameron",
                cast: "Sam Worthington, Zoe Saldana"
            },
            {
                id: 2,
                title: "Spider-Man: Across the Spider-Verse",
                genre: "Ho·∫°t H√¨nh",
                duration: "2h 20m",
                rating: 4.9,
                price: 110000,
                image: "https://image.tmdb.org/t/p/w500/8Vt6mWEReuy4Of61Lnj5Xj704m8.jpg",
                backdrop: "https://image.tmdb.org/t/p/original/4HodYYKEIsGOdinkGi2Ucz6X9i0.jpg",
                description: "Miles Morales t√°i xu·∫•t trong ph·∫ßn ti·∫øp theo c·ªßa lo·∫°t phim Spider-Verse.",
                director: "Joaquim Dos Santos",
                cast: "Shameik Moore, Hailee Steinfeld"
            },
            {
                id: 3,
                title: "Oppenheimer",
                genre: "L·ªãch S·ª≠",
                duration: "3h 00m",
                rating: 4.7,
                price: 115000,
                image: "https://image.tmdb.org/t/p/w500/8Gxv8gSFCU0XGDykEGv7zR1n2ua.jpg",
                backdrop: "https://image.tmdb.org/t/p/original/rLb2cs785xa3VIIyncefpRJflkZ.jpg",
                description: "C√¢u chuy·ªán v·ªÅ nh√† v·∫≠t l√Ω l√Ω thuy·∫øt J. Robert Oppenheimer.",
                director: "Christopher Nolan",
                cast: "Cillian Murphy, Emily Blunt"
            },
            {
                id: 4,
                title: "Dune: Part Two",
                genre: "Vi·ªÖn T∆∞·ªüng",
                duration: "2h 46m",
                rating: 4.6,
                price: 130000,
                image: "https://image.tmdb.org/t/p/w500/1pdfLvkbY9ohJlCjQH2CZjjYVvJ.jpg",
                backdrop: "https://image.tmdb.org/t/p/original/xOMo8BRK7PfcJv9JCnx7s5hj0PX.jpg",
                description: "Paul Atreides h·ª£p nh·∫•t v·ªõi Chani v√† ng∆∞·ªùi Fremen.",
                director: "Denis Villeneuve",
                cast: "Timoth√©e Chalamet, Zendaya"
            }
        ];

        const RAW_SHOWTIMES = ["09:30", "11:45", "14:15", "16:50", "19:30", "22:15"];
        const GENRES = ['T·∫•t c·∫£', 'H√†nh ƒë·ªông', 'Vi·ªÖn t∆∞·ªüng', 'Kinh d·ªã', 'Ho·∫°t h√¨nh', 'L·ªãch S·ª≠'];

        const FOOD_MENU = [
            { id: 'f1', name: "B·∫Øp Ng·ªçt (S)", price: 45000, icon: "üçø" },
            { id: 'f2', name: "B·∫Øp Ph√¥ Mai (M)", price: 65000, icon: "üßÄ" },
            { id: 'f4', name: "Coca Cola", price: 35000, icon: "ü•§" },
            { id: 'f5', name: "N∆∞·ªõc Su·ªëi", price: 15000, icon: "üíß" },
        ];

        const PAYMENT_METHODS = [
            { id: 'zalo', name: 'ZaloPay', icon: 'Z' },
            { id: 'momo', name: 'Momo', icon: 'M' },
            { id: 'card', name: 'Th·∫ª ATM', icon: 'üí≥' },
            { id: 'cash', name: 'Ti·ªÅn m·∫∑t', icon: 'üíµ' },
        ];

        // --- Logic sinh d·ªØ li·ªáu gh·∫ø ng·∫´u nhi√™n ---
        const generateSessionData = () => {
            const sessions = {};
            const rows = 7; 
            const cols = 8;
            const totalSeats = rows * cols;

            RAW_SHOWTIMES.forEach(time => {
                const occupied = new Set();
                const fullness = 0.2 + Math.random() * 0.75; 
                
                for(let r=0; r<rows; r++) {
                    const rowLabel = String.fromCharCode(65+r);
                    for(let c=1; c<=cols; c++) {
                        if(Math.random() < fullness) {
                            occupied.add(`${rowLabel}${c}`);
                        }
                    }
                }
                sessions[time] = { time, occupied, availableCount: totalSeats - occupied.size };
            });
            return sessions;
        };

        // --- Components UI ---
        const MobileSeat = ({ id, status, type, onClick }) => {
            let bgColor = "bg-slate-700";
            let additionalClass = "";
            let textColor = "text-white/60";

            if (status === 'selected') {
                bgColor = "bg-green-500 shadow-[0_0_15px_rgba(34,197,94,0.6)]";
                additionalClass = "scale-110 z-10 border-white border"; 
                textColor = "text-white";
            }
            else if (status === 'occupied') {
                bgColor = "bg-slate-800/40 cursor-not-allowed";
                additionalClass = "opacity-30";
                textColor = "text-transparent";
            }
            else if (type === 'vip') {
                bgColor = "bg-purple-600 border border-purple-400 shadow-[0_0_10px_rgba(147,51,234,0.3)]";
                textColor = "text-purple-100";
            }

            return (
                <button
                    disabled={status === 'occupied'}
                    onClick={() => status !== 'occupied' && onClick()}
                    className={`w-8 h-8 m-1 rounded-t-lg ${bgColor} flex items-center justify-center text-[9px] font-bold ${textColor} transition-all duration-300 active:scale-90 transform ${additionalClass}`}
                />
            );
        };

        const BottomNav = ({ activeTab, onTabChange }) => (
            <div className="fixed bottom-0 left-0 w-full bg-black/90 backdrop-blur-md border-t border-slate-800 h-20 flex justify-around items-center z-50 pb-safe-bottom">
                <button onClick={() => onTabChange('home')} className={`flex flex-col items-center gap-1 ${activeTab === 'home' ? 'text-blue-500' : 'text-slate-500'} transition-colors`}>
                    <Home size={20} className="transition-transform active:scale-90" />
                    <span className="text-[10px] font-medium">Trang Ch·ªß</span>
                </button>
                <button onClick={() => onTabChange('schedule')} className={`flex flex-col items-center gap-1 ${activeTab === 'schedule' ? 'text-blue-500' : 'text-slate-500'} transition-colors`}>
                    <Calendar size={20} className="transition-transform active:scale-90" />
                    <span className="text-[10px] font-medium">L·ªãch Chi·∫øu</span>
                </button>
                <div className="w-14"></div> 
                <button onClick={() => onTabChange('offers')} className={`flex flex-col items-center gap-1 ${activeTab === 'offers' ? 'text-blue-500' : 'text-slate-500'} transition-colors`}>
                    <Gift size={20} className="transition-transform active:scale-90" />
                    <span className="text-[10px] font-medium">∆Øu ƒê√£i</span>
                </button>
                <button onClick={() => onTabChange('news')} className={`flex flex-col items-center gap-1 ${activeTab === 'news' ? 'text-blue-500' : 'text-slate-500'} transition-colors`}>
                    <Newspaper size={20} className="transition-transform active:scale-90" />
                    <span className="text-[10px] font-medium">Tin T·ª©c</span>
                </button>
                <div className="absolute -top-6 left-1/2 transform -translate-x-1/2">
                    <button onClick={() => onTabChange('home')} className="w-16 h-16 bg-blue-600 rounded-full shadow-[0_0_20px_rgba(37,99,235,0.6)] flex items-center justify-center border-[6px] border-black transition-transform active:scale-90 active:rotate-90">
                        <Ticket size={28} className="text-white fill-white" />
                    </button>
                </div>
            </div>
        );

        const BookingSheet = ({ movie, onClose }) => {
            const [step, setStep] = useState(1);
            const [selectedTime, setSelectedTime] = useState(null);
            const [selectedSeats, setSelectedSeats] = useState([]);
            const [foodCart, setFoodCart] = useState({});
            const [isPaid, setIsPaid] = useState(false);
            const sessionData = useMemo(() => generateSessionData(), []);

            const handleSeatClick = (id, price, type) => {
                if (selectedSeats.find(s => s.id === id)) {
                    setSelectedSeats(selectedSeats.filter(s => s.id !== id));
                } else {
                    setSelectedSeats([...selectedSeats, { id, price, type }]);
                }
            };

            const total = selectedSeats.reduce((sum, s) => sum + s.price, 0) + 
                            Object.entries(foodCart).reduce((sum, [id, qty]) => {
                                const item = FOOD_MENU.find(i => i.id === id);
                                return sum + (item.price * qty);
                            }, 0);

            const renderSeats = () => {
                let grid = [];
                const rows = 7; 
                const cols = 8;
                const currentSession = sessionData[selectedTime];
                const occupiedSet = currentSession ? currentSession.occupied : new Set();

                for(let r=0; r<rows; r++) {
                    let rowSeats = [];
                    const rowLabel = String.fromCharCode(65+r);
                    const isCrystalRow = ['D', 'E', 'F'].includes(rowLabel);

                    rowSeats.push(
                        <div key={`label-${r}`} className="w-6 flex items-center justify-center text-[10px] font-bold text-slate-500">
                            {rowLabel}
                        </div>
                    );

                    for(let c=1; c<=cols; c++) {
                        const id = `${rowLabel}${c}`;
                        let type = 'normal';
                        if (isCrystalRow) {
                            if (c >= 3 && c <= 6) type = 'vip'; 
                        }
                        const price = type === 'vip' ? 180000 : movie.price;
                        const status = selectedSeats.find(s => s.id === id) ? 'selected' : 'available';
                        const isOccupied = occupiedSet.has(id);
                        rowSeats.push(
                            <MobileSeat key={id} id={id} status={isOccupied ? 'occupied' : status} type={type} onClick={() => handleSeatClick(id, price, type)} />
                        );
                    }
                    grid.push(<div key={r} className="flex justify-center items-center mb-1">{rowSeats}</div>);
                }
                return grid;
            };

            if (isPaid) {
                return (
                    <div className="fixed inset-0 z-[60] bg-black flex flex-col items-center justify-center p-6 text-center animate-in zoom-in duration-300">
                        <div className="w-24 h-24 bg-green-500 rounded-full flex items-center justify-center mb-6 shadow-[0_0_30px_rgba(34,197,94,0.6)] animate-bounce"><CheckCircle size={48} className="text-white" /></div>
                        <h2 className="text-3xl font-bold text-white mb-2">Th√†nh C√¥ng!</h2>
                        <p className="text-slate-400 mb-8 max-w-[200px]">V√© ƒë√£ ƒë∆∞·ª£c g·ª≠i v√†o v√≠ c·ªßa b·∫°n.</p>
                        <button onClick={onClose} className="w-full bg-slate-800 text-white py-4 rounded-2xl font-bold active:scale-95 transition-transform">ƒê√≥ng</button>
                    </div>
                );
            }

            return (
                <div className="fixed inset-0 z-[60] flex items-end sm:items-center justify-center pointer-events-none">
                    <div className="absolute inset-0 bg-black/80 pointer-events-auto backdrop-blur-sm transition-opacity duration-300" onClick={onClose}></div>
                    <div className="bg-slate-900 w-full sm:max-w-[420px] h-[92vh] sm:h-[800px] rounded-t-3xl sm:rounded-2xl relative pointer-events-auto flex flex-col animate-in slide-in-from-bottom duration-300 overflow-hidden shadow-2xl border-t border-slate-700 pb-safe-bottom">
                        <div className="p-5 border-b border-slate-800 flex items-center justify-between shrink-0 bg-slate-900 z-10">
                            <div>
                                <h3 className="text-white font-bold text-lg truncate max-w-[200px]">{movie.title}</h3>
                                <div className="flex items-center gap-2 mt-1">
                                    <span className="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></span>
                                    <p className="text-slate-400 text-xs font-bold uppercase tracking-wider">{step === 1 ? 'Ch·ªçn Gi·ªù' : step === 2 ? 'Ch·ªçn Gh·∫ø' : step === 3 ? 'B·∫Øp N∆∞·ªõc' : 'Thanh To√°n'}</p>
                                </div>
                            </div>
                            <button onClick={onClose} className="bg-slate-800 p-2 rounded-full text-white hover:bg-slate-700 transition-colors"><X size={20}/></button>
                        </div>

                        <div className="flex-1 overflow-y-auto p-5 hide-scrollbar relative pb-24">
                            {step === 1 && (
                                <div className="grid grid-cols-2 gap-4 animate-fade-in">
                                    {RAW_SHOWTIMES.map(time => {
                                        const info = sessionData[time];
                                        const isFull = info.availableCount === 0;
                                        return (
                                            <button key={time} disabled={isFull} onClick={() => { setSelectedTime(time); setStep(2); }} 
                                                className={`group p-5 bg-slate-800 rounded-2xl border border-slate-700 transition-all active:scale-95 relative overflow-hidden ${isFull ? 'opacity-50 grayscale cursor-not-allowed' : 'hover:border-blue-500 hover:bg-blue-600'}`}>
                                                <span className="text-white font-bold text-2xl block mb-1 group-hover:scale-110 transition-transform">{time}</span>
                                                <span className={`text-xs ${isFull ? 'text-red-400 font-bold' : 'text-slate-400 group-hover:text-white/80'}`}>{isFull ? 'H·∫øt v√©' : `Gh·∫ø tr·ªëng: ${info.availableCount}`}</span>
                                            </button>
                                        );
                                    })}
                                </div>
                            )}

                            {step === 2 && (
                                <div className="flex flex-col items-center pt-2 animate-fade-in">
                                    <div className="w-[80%] mb-4 flex flex-col items-center justify-center">
                                        <div className="screen-arc mb-2"></div> 
                                        <span className="text-slate-500 text-[10px] tracking-[0.3em] font-medium opacity-60 uppercase">M√†n h√¨nh</span>
                                    </div>
                                    <div className="mb-8">{renderSeats()}</div>
                                    <div className="w-full flex flex-wrap justify-between gap-3 text-[11px] text-slate-400 bg-slate-800/40 py-4 px-4 rounded-2xl border border-slate-800">
                                        <div className="flex items-center gap-2"><div className="w-5 h-5 bg-slate-800 opacity-40 rounded-t-md border border-slate-600"></div> <span>ƒê√£ ƒë·∫∑t</span></div>
                                        <div className="flex items-center gap-2"><div className="w-5 h-5 bg-slate-700 rounded-t-md"></div> <span>Th∆∞·ªùng</span></div>
                                        <div className="flex items-center gap-2"><div className="w-5 h-5 bg-purple-600 border border-purple-400 rounded-t-md"></div> <span>Crystal</span></div>
                                        <div className="flex items-center gap-2"><div className="w-5 h-5 bg-green-500 rounded-t-md border border-white"></div> <span>Ch·ªçn</span></div>
                                    </div>
                                </div>
                            )}

                            {step === 3 && (
                                <div className="space-y-4 animate-fade-in">
                                    {FOOD_MENU.map(item => (
                                        <div key={item.id} className="flex items-center justify-between bg-slate-800 p-4 rounded-2xl border border-slate-700/50">
                                            <div className="flex items-center gap-4">
                                                <span className="text-3xl bg-slate-700 p-2 rounded-xl">{item.icon}</span>
                                                <div><div className="text-white font-bold text-sm">{item.name}</div><div className="text-blue-400 text-sm font-medium">{item.price.toLocaleString()}ƒë</div></div>
                                            </div>
                                            <div className="flex items-center gap-3 bg-slate-900 rounded-lg p-1">
                                                <button onClick={() => setFoodCart({...foodCart, [item.id]: Math.max(0, (foodCart[item.id]||0)-1)})} className="w-8 h-8 hover:bg-slate-700 rounded-md text-white flex items-center justify-center transition-colors">-</button>
                                                <span className="text-white text-sm w-4 text-center font-bold">{foodCart[item.id]||0}</span>
                                                <button onClick={() => setFoodCart({...foodCart, [item.id]: (foodCart[item.id]||0)+1})} className="w-8 h-8 bg-blue-600 hover:bg-blue-500 rounded-md text-white flex items-center justify-center shadow-lg shadow-blue-600/30 transition-all active:scale-90">+</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {step === 4 && (
                                <div className="space-y-5 animate-fade-in">
                                    <div className="bg-white p-6 rounded-3xl shadow-xl relative overflow-hidden">
                                        <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500"></div>
                                        <div className="border-b-2 border-dashed border-slate-200 pb-4 mb-4">
                                            <h4 className="font-bold text-slate-900 text-lg">Th√¥ng tin ƒë·∫∑t v√©</h4>
                                            <p className="text-slate-500 text-xs">Vui l√≤ng ki·ªÉm tra k·ªπ tr∆∞·ªõc khi thanh to√°n</p>
                                        </div>
                                        <div className="space-y-3 text-sm text-slate-600">
                                            <div className="flex justify-between items-center"><span>Phim</span> <span className="font-bold text-slate-900 text-right truncate w-40">{movie.title}</span></div>
                                            <div className="flex justify-between items-center"><span>Su·∫•t chi·∫øu</span> <span className="font-bold text-slate-900 bg-slate-100 px-2 py-0.5 rounded">{selectedTime}</span></div>
                                            <div className="flex justify-between items-center"><span>Gh·∫ø</span> <span className="font-bold text-slate-900 text-right break-words w-40">{selectedSeats.map(s=>s.id).join(', ')}</span></div>
                                            <div className="flex justify-between items-center"><span>B·∫Øp n∆∞·ªõc</span> <span className="font-bold text-slate-900">{Object.values(foodCart).reduce((a,b)=>a+b,0)} m√≥n</span></div>
                                            <div className="border-t-2 border-slate-100 pt-3 mt-3 flex justify-between text-lg font-bold text-blue-600 items-end"><span className="text-sm font-normal text-slate-500">T·ªïng c·ªông</span><span>{total.toLocaleString()} ƒë</span></div>
                                        </div>
                                    </div>
                                    <div>
                                        <h4 className="text-white font-bold text-sm mb-3 ml-1">Ph∆∞∆°ng th·ª©c thanh to√°n</h4>
                                        <div className="grid grid-cols-2 gap-3">
                                            {PAYMENT_METHODS.map(m => (
                                                <button key={m.id} onClick={() => setIsPaid(true)} className="p-4 bg-slate-800 rounded-xl flex items-center gap-3 hover:bg-blue-600/20 hover:border-blue-500 border border-transparent transition-all active:scale-95 group">
                                                    <span className="text-xl group-hover:scale-110 transition-transform">{m.icon}</span><span className="text-white text-sm font-medium">{m.name}</span>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                        <div className="p-5 border-t border-slate-800 bg-slate-900 shrink-0 pb-safe-bottom absolute bottom-0 w-full">
                            <div className="flex justify-between items-center mb-4">
                                <div className="flex flex-col"><span className="text-slate-400 text-xs font-medium">T·ªïng ti·ªÅn t·∫°m t√≠nh</span><span className="text-white font-bold text-2xl tracking-tight">{total.toLocaleString()} <span className="text-sm text-slate-500 font-normal">VND</span></span></div>
                                <div className="flex gap-1">{[1,2,3,4].map(s => (<div key={s} className={`w-2 h-2 rounded-full ${step >= s ? 'bg-blue-500' : 'bg-slate-700'} transition-colors`}></div>))}</div>
                            </div>
                            {step < 4 ? (
                                <button disabled={step === 2 && selectedSeats.length === 0} onClick={() => setStep(step + 1)} className="w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 disabled:from-slate-700 disabled:to-slate-800 disabled:text-slate-500 text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-2 transition-all shadow-lg shadow-blue-900/20 active:scale-[0.98]">Ti·∫øp t·ª•c <ArrowRight size={18}/></button>
                            ) : (
                                <button onClick={() => setStep(3)} className="w-full bg-slate-800 hover:bg-slate-700 text-white py-4 rounded-2xl font-bold transition-colors">Quay l·∫°i</button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('home');
            const [selectedMovie, setSelectedMovie] = useState(null);
            
            // Search & Filter State
            const [searchQuery, setSearchQuery] = useState('');
            const [isSearchOpen, setIsSearchOpen] = useState(false);
            const [selectedGenre, setSelectedGenre] = useState('T·∫•t c·∫£');

            // Filtering Logic
            const filteredMovies = useMemo(() => {
                return MOVIES.filter(movie => {
                    const matchesSearch = movie.title.toLowerCase().includes(searchQuery.toLowerCase());
                    const matchesGenre = selectedGenre === 'T·∫•t c·∫£' || movie.genre === selectedGenre;
                    return matchesSearch && matchesGenre;
                });
            }, [searchQuery, selectedGenre]);

            // Render Views based on Tab
            const renderContent = () => {
                switch(activeTab) {
                    case 'schedule':
                        return (
                             <div className="px-5 animate-fade-in">
                                <h2 className="text-white font-bold text-lg mb-4 flex items-center gap-2">L·ªãch chi·∫øu h√¥m nay</h2>
                                <div className="space-y-4">
                                    {MOVIES.map(movie => (
                                        <div key={movie.id} className="bg-slate-900/50 p-4 rounded-3xl border border-slate-800/50 flex gap-4">
                                            <img src={movie.image} className="w-20 h-28 rounded-xl object-cover shrink-0" alt={movie.title}/>
                                            <div className="flex-1">
                                                <h3 className="text-white font-bold text-base mb-2">{movie.title}</h3>
                                                <div className="flex flex-wrap gap-2">
                                                    {RAW_SHOWTIMES.slice(0, 4).map(time => (
                                                        <button key={time} onClick={() => setSelectedMovie(movie)} className="bg-slate-800 text-blue-400 text-xs font-bold px-3 py-1.5 rounded-lg border border-slate-700 hover:bg-blue-600 hover:text-white transition-colors">
                                                            {time}
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        );
                    case 'offers':
                        return (
                            <div className="px-5 animate-fade-in h-[60vh] flex flex-col items-center justify-center text-center">
                                <Gift size={48} className="text-blue-500 mb-4 opacity-50" />
                                <h2 className="text-xl font-bold mb-2">∆Øu ƒë√£i c·ªßa b·∫°n</h2>
                                <p className="text-slate-400">Hi·ªán ch∆∞a c√≥ ∆∞u ƒë√£i n√†o m·ªõi. Quay l·∫°i sau nh√©!</p>
                            </div>
                        );
                    case 'news':
                         return (
                            <div className="px-5 animate-fade-in h-[60vh] flex flex-col items-center justify-center text-center">
                                <Newspaper size={48} className="text-blue-500 mb-4 opacity-50" />
                                <h2 className="text-xl font-bold mb-2">Tin t·ª©c ƒëi·ªán ·∫£nh</h2>
                                <p className="text-slate-400">ƒêang c·∫≠p nh·∫≠t...</p>
                            </div>
                        );
                    case 'home':
                    default:
                        return (
                            <>
                                {/* Banner Slider */}
                                <div className="pl-5 overflow-x-auto flex gap-4 hide-scrollbar mb-8 pr-5 py-2 animate-fade-in">
                                    {MOVIES.slice(0, 3).map((movie, idx) => (
                                        <div key={movie.id} className="min-w-[85vw] sm:min-w-[320px] aspect-[16/9] rounded-3xl overflow-hidden relative group shrink-0 shadow-lg shadow-black/50 transition-transform active:scale-95" onClick={() => setSelectedMovie(movie)}>
                                            <img src={movie.backdrop} className="w-full h-full object-cover" alt={movie.title} />
                                            <div className="absolute inset-0 bg-gradient-to-t from-black via-black/20 to-transparent flex flex-col justify-end p-5">
                                                {/* Only show "ƒêang Hot" for the first movie */}
                                                {idx === 0 && (
                                                    <span className="text-blue-400 text-[10px] font-black uppercase tracking-wider mb-1 bg-black/60 w-fit px-2 py-0.5 rounded backdrop-blur-sm shadow-sm">ƒêang Hot</span>
                                                )}
                                                <h3 className="text-white font-bold text-lg truncate leading-tight drop-shadow-md">{movie.title}</h3>
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                {/* Categories */}
                                <div className="px-5 mb-6 animate-fade-in delay-75">
                                    <h2 className="text-white font-bold text-lg mb-4 flex items-center gap-2">Th·ªÉ lo·∫°i <span className="w-1 h-1 bg-blue-500 rounded-full"></span></h2>
                                    <div className="flex gap-3 overflow-x-auto hide-scrollbar pb-2">
                                        {GENRES.map((g, i) => (
                                            <button 
                                                key={g} 
                                                onClick={() => setSelectedGenre(g)}
                                                className={`px-5 py-2.5 rounded-2xl text-xs font-bold whitespace-nowrap transition-all duration-300 ${
                                                    selectedGenre === g 
                                                    ? 'bg-blue-600 text-white shadow-lg shadow-blue-600/25 scale-105' 
                                                    : 'bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-white'
                                                }`}
                                            >
                                                {g}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Movie List */}
                                <div className="px-5 animate-fade-in delay-100">
                                    <div className="flex justify-between items-end mb-4">
                                        <h2 className="text-white font-bold text-lg">
                                            {selectedGenre === 'T·∫•t c·∫£' ? 'Phim ƒëang chi·∫øu' : `Phim ${selectedGenre}`}
                                        </h2>
                                        {filteredMovies.length > 0 && <span className="text-slate-500 text-xs">{filteredMovies.length} phim</span>}
                                    </div>
                                    
                                    {filteredMovies.length === 0 ? (
                                        <div className="text-center py-10 text-slate-500">
                                            <p>Kh√¥ng t√¨m th·∫•y phim ph√π h·ª£p.</p>
                                        </div>
                                    ) : (
                                        <div className="flex flex-col gap-4">
                                            {filteredMovies.map(movie => (
                                                <div key={movie.id} onClick={() => setSelectedMovie(movie)} className="flex gap-4 bg-slate-900/50 p-3 rounded-3xl border border-slate-800/50 active:scale-[0.98] transition-all hover:bg-slate-800/50 group">
                                                    <div className="relative shrink-0">
                                                        <img src={movie.image} className="w-24 h-32 rounded-2xl object-cover shadow-lg" alt={movie.title}/>
                                                        <div className="absolute top-2 left-2 bg-black/60 backdrop-blur-md px-1.5 py-0.5 rounded text-[10px] text-white font-bold flex items-center gap-0.5"><Star size={8} className="text-yellow-400 fill-yellow-400"/> {movie.rating}</div>
                                                    </div>
                                                    <div className="flex-1 py-1 flex flex-col justify-between">
                                                        <div>
                                                            <h3 className="text-white font-bold text-base mb-1 line-clamp-1 group-hover:text-blue-400 transition-colors">{movie.title}</h3>
                                                            <div className="flex items-center gap-2 text-xs text-slate-400 mb-2"><Clock size={12} /> {movie.duration} <span className="w-1 h-1 bg-slate-600 rounded-full"></span><span>2D</span></div>
                                                            <div className="flex flex-wrap gap-1 mb-2"><span className="px-2 py-0.5 bg-slate-800 rounded text-[10px] text-slate-300 border border-slate-700">{movie.genre}</span></div>
                                                        </div>
                                                        <button className="self-start bg-blue-600 text-white text-xs font-bold px-5 py-2 rounded-xl shadow-lg shadow-blue-600/20 group-hover:bg-blue-500 transition-colors">ƒê·∫∑t V√©</button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </>
                        );
                }
            };

            return (
                <IOSGatekeeper>
                    <div className="min-h-screen w-full bg-black font-sans text-slate-200 pb-20">
                        {/* Header */}
                        <header className="px-5 pt-safe-top pb-4 flex flex-col gap-4 bg-gradient-to-b from-black via-black/90 to-transparent sticky top-0 z-40 backdrop-blur-sm pt-4 transition-all duration-300">
                            <div className="flex justify-between items-center w-full">
                                <div>
                                    <p className="text-slate-400 text-xs font-medium mb-0.5">Xin ch√†o,</p>
                                    <h1 className="text-white font-bold text-xl flex items-center gap-1">BONN<span className="text-blue-500">CINEMAS</span></h1>
                                </div>
                                <div className="flex gap-3">
                                    <button 
                                        onClick={() => setIsSearchOpen(!isSearchOpen)}
                                        className={`w-10 h-10 backdrop-blur-md rounded-full flex items-center justify-center text-white transition-all ${isSearchOpen ? 'bg-blue-600' : 'bg-slate-800/80 hover:bg-slate-700'}`}
                                    >
                                        {isSearchOpen ? <X size={18} /> : <Search size={18} />}
                                    </button>
                                    <button className="w-10 h-10 bg-slate-800/80 backdrop-blur-md rounded-full flex items-center justify-center text-white overflow-hidden ring-2 ring-transparent hover:ring-blue-500 transition-all">
                                        <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?auto=format&fit=crop&w=100&h=100" alt="User" />
                                    </button>
                                </div>
                            </div>
                            
                            {/* Search Bar - Expandable */}
                            <div className={`overflow-hidden transition-all duration-300 ease-in-out ${isSearchOpen ? 'max-h-16 opacity-100' : 'max-h-0 opacity-0'}`}>
                                <div className="relative">
                                    <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500" size={16} />
                                    <input 
                                        type="text" 
                                        placeholder="T√¨m t√™n phim..." 
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        className="w-full bg-slate-800 border border-slate-700 text-white text-sm rounded-xl py-3 pl-10 pr-4 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all placeholder:text-slate-500"
                                    />
                                    {searchQuery && (
                                        <button onClick={() => setSearchQuery('')} className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-white">
                                            <X size={14} />
                                        </button>
                                    )}
                                </div>
                            </div>
                        </header>

                        <main className="pb-24">
                            {renderContent()}
                        </main>

                        <BottomNav activeTab={activeTab} onTabChange={(tab) => { setActiveTab(tab); window.scrollTo({ top: 0, behavior: 'smooth' }); }} />
                        {selectedMovie && <BookingSheet movie={selectedMovie} onClose={() => setSelectedMovie(null)} />}
                    </div>
                </IOSGatekeeper>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
